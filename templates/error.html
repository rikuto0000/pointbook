<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>エラー {{ error_code }} | VALORANT Pointbook</title>

  <!-- ✅ PWA対応 -->
  <link rel="manifest" href="/static/manifest.json">
  <meta name="theme-color" content="#ff4655">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-title" content="Pointbook">
  <link rel="apple-touch-icon" href="/static/icons/icon-192.png">

  <!-- ✅ Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- ✅ Rajdhani Font -->
  <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;500;700&display=swap" rel="stylesheet">

  <!-- ✅ Modern Styles -->
  <link rel="stylesheet" href="/static/css/modern.css">

  <!-- ✅ Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

  <!-- Fallback styles -->
  {% include 'base_styles.html' %}
</head>

<body class="min-h-screen flex flex-col">
  <!-- Header -->
  {% include 'header.html' %}
  
  <!-- Animated Background Particles -->
  <div class="particles">
    {% for i in range(6) %}
    <div class="particle" style="left: {{ (i * 15 + 10) }}%; animation-delay: {{ i * 0.8 }}s;"></div>
    {% endfor %}
  </div>

  <!-- Main Content -->
  <main class="min-h-screen flex items-center justify-center px-4">
    <div class="max-w-lg w-full">
      
      <!-- Error Card -->
      <div class="glass rounded-2xl p-8 text-center" style="animation: fadeInUp 0.8s ease-out;">
        
        <!-- Error Icon -->
        <div class="w-20 h-20 mx-auto mb-6 flex items-center justify-center">
          {% if error_code == 404 %}
            <div class="w-full h-full bg-gradient-to-br from-yellow-500 to-orange-600 rounded-full flex items-center justify-center">
              <i class="fas fa-search text-white text-3xl"></i>
            </div>
          {% elif error_code == 500 %}
            <div class="w-full h-full bg-gradient-to-br from-red-500 to-red-600 rounded-full flex items-center justify-center">
              <i class="fas fa-exclamation-triangle text-white text-3xl"></i>
            </div>
          {% elif error_code == 413 %}
            <div class="w-full h-full bg-gradient-to-br from-blue-500 to-blue-600 rounded-full flex items-center justify-center">
              <i class="fas fa-file-upload text-white text-3xl"></i>
            </div>
          {% else %}
            <div class="w-full h-full bg-gradient-to-br from-gray-500 to-gray-600 rounded-full flex items-center justify-center">
              <i class="fas fa-bug text-white text-3xl"></i>
            </div>
          {% endif %}
        </div>

        <!-- Error Code -->
        <h1 class="text-6xl font-bold text-glow mb-4">
          {{ error_code }}
        </h1>

        <!-- Error Message -->
        <h2 class="text-2xl font-bold text-white mb-4">
          {{ error_message }}
        </h2>

        <!-- Description -->
        <p class="text-gray-300 mb-8">
          {% if error_code == 404 %}
            お探しのページは見つかりませんでした。URLを確認するか、ホームページから再度お試しください。
          {% elif error_code == 500 %}
            サーバーで問題が発生しました。しばらく時間をおいてから再度お試しください。
          {% elif error_code == 413 %}
            アップロードしたファイルのサイズが制限を超えています。より小さなファイルをお試しください。
          {% else %}
            予期しないエラーが発生しました。問題が続く場合はサポートにお問い合わせください。
          {% endif %}
        </p>

        <!-- Action Buttons -->
        <div class="flex flex-col sm:flex-row gap-4 justify-center">
          <a href="/" class="btn-primary inline-flex items-center justify-center gap-2">
            <i class="fas fa-home"></i>
            <span>ホームに戻る</span>
          </a>
          
          <button onclick="history.back()" class="inline-flex items-center justify-center gap-2 bg-gray-600 hover:bg-gray-500 text-white font-semibold py-3 px-6 rounded-lg transition-colors">
            <i class="fas fa-arrow-left"></i>
            <span>前のページに戻る</span>
          </button>
        </div>

        <!-- Additional Help -->
        <div class="mt-8 pt-6 border-t border-gray-600">
          <p class="text-gray-400 text-sm mb-4">お困りですか？</p>
          <div class="flex justify-center gap-6 text-sm">
            <a href="/" class="text-gray-300 hover:text-white transition-colors flex items-center gap-1">
              <i class="fas fa-map"></i>
              <span>マップ選択</span>
            </a>
            <a href="/add" class="text-gray-300 hover:text-white transition-colors flex items-center gap-1">
              <i class="fas fa-plus"></i>
              <span>定点追加</span>
            </a>
            <button onclick="location.reload()" class="text-gray-300 hover:text-white transition-colors flex items-center gap-1">
              <i class="fas fa-redo"></i>
              <span>再読み込み</span>
            </button>
          </div>
        </div>
      </div>

      <!-- Error ID (for debugging) -->
      <div class="text-center mt-4">
        <p class="text-gray-500 text-xs">
          Error ID: {{ error_code }}-{{ moment().format('YYYYMMDD-HHmmss') if moment else 'unknown' }}
        </p>
      </div>

    </div>
  </main>

  <script>
    // Enhanced interactions with error handling
    document.addEventListener('DOMContentLoaded', function() {
      try {
        // Parallax effect for particles
        document.addEventListener('mousemove', function(e) {
          try {
            const particles = document.querySelectorAll('.particle');
            if (particles.length > 0) {
              const mouseX = e.clientX / window.innerWidth;
              const mouseY = e.clientY / window.innerHeight;

              particles.forEach((particle, index) => {
                const speed = (index + 1) * 0.3;
                const x = mouseX * speed * 10;
                const y = mouseY * speed * 10;
                if (particle && particle.style) {
                  particle.style.transform = `translateX(${x}px) translateY(${y}px)`;
                }
              });
            }
          } catch (err) {
            console.warn('Parallax error:', err);
          }
        });

        // Auto-redirect for certain errors (optional)
        {% if error_code == 404 %}
        setTimeout(() => {
          if (confirm('ページが見つかりません。ホームページに戻りますか？')) {
            window.location.href = '/';
          }
        }, 10000); // 10秒後
        {% endif %}

      } catch (err) {
        console.error('Script initialization error:', err);
      }
    });

    // Global error handler
    window.addEventListener('error', function(e) {
      console.error('Global error:', e.error);
    });
  </script>
</body>
</html>